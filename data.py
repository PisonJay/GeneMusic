import play
import random
import numpy as np

def gen_note(n):
    note = play.get_random_weight()
    note_set = list(note.keys())
    note_wei = np.array(list(note.values()))
    note_wei /= sum(note_wei)
    return list(np.random.choice(note_set, n, p = note_wei))

def gen_section(op):
    if (op == 0): # 4, 4, 4, 4
        return gen_note(4), [4] * 4
    elif (op == 1): # 4, 8, 8, 4, 8, 8
        return gen_note(6), [4, 8, 8] * 2
    elif (op == 2): # 4, 8, 4, 8, 4
        return gen_note(5), [4, 8, 4, 8, 4]
    else: # 4, 4, 4, 8, 8
        return gen_note(4), [4, 4, 4, 8, 8]

def gen_rhythm(__cases):
    note = []
    dura = []

    for _ in range(__cases):
        __note = []
        __dura = []

        for i in range(4):
            op = random.randint(0, 3)
            __section = gen_section(op)
            __note += __section[0]
            __dura += __section[1]

        note.append(__note)
        dura.append(__dura)

    return note, dura


sample_note = [
    ['D4', 'E4', 'F4', 'G4', 'A4', 'D5', 'c5', 'A4', 'E4', 'G4', 'f4', 'D4', 'C5', '', 'B4', 'A4', 'a4', 'G4', 'E4', 'G4', 'B4', 'D4', 'c4', 'A4', 'D4', 'G4', 'F4', 'E4', 'D4', 'c4', 'D4', 'E4', 'f4', 'g4', 'A4', 'B4'],
    ['f4', 'E4', 'E4', 'E4', 'E5', 'D5', 'c5', 'B4', 'A4', 'D5', 'A4', 'G4', 'f4', 'G4', 'E4', 'D4', '', '', ''] ,
    ['C5', '', 'A4', 'f4', 'f4', 'B4', 'f4', 'g4', 'A4', 'D4', 'C4', 'A3', 'A3', '', '', 'd4', '', 'B4', 'c5', 'D5', 'F4', '', 'g4', 'D5', 'D5', 'D5', 'c5'] ,
    ['D3', 'd3', 'F3', 'G3', 'F3', 'E3', 'F3', 'G3', 'A3', 'G3', 'F3', 'G3', 'A3', 'a3', 'A3', 'G3', 'A3', 'F3', 'G3', 'E3', 'A3', 'G3', 'A3', 'F3', 'G3', 'd3', 'F3', 'D3', 'G3', 'F3', 'G3', 'd3', 'F3', 'D3', 'd3', 'C3', 'F3', 'd3', 'F3', 'D3', 'd3', 'C3', 'D3', 'a2', 'd3', 'D3', 'd3', 'C3', 'D3', 'a2', 'C3', 'A2', 'D3', 'C3', 'D3'] ,
    ['A5', 'G5', 'E5', 'D5', 'G4', '', 'C5', 'B4', 'A4', 'G4', 'G4', 'B4', 'c5'] ,
    ['a4', 'A4', 'G4', 'F4', 'G4', 'A4', 'a4', 'A4', 'F4', 'F4', 'F4', 'G4', 'F4', 'G4', 'A4', 'A4', 'a4', 'A4', 'G4', 'F4', 'D4', 'E4'] ,
    ['F4', '', 'F4', 'a4', 'C5', 'D5', 'd5', 'F5', 'F5', 'd5', 'D5', 'C5', 'D5', '', 'D5', 'd5'] ,
    ['c5', 'A4', 'B4', 'A4', 'c5', '', '', 'a4', 'f4', 'G4', 'G4', 'f4', 'f4', '', '', '', '', '', 'E4', 'f4', 'E4'] ,
    ['A4', 'a4', 'a4', 'A4', '', 'a4', 'a4', 'A4', 'G4', 'F4', 'G4', 'A4', 'a4', 'A4', 'F4', 'F4'] ,
    ['C4', 'D4', 'C4', 'a3', 'A3', 'D4', 'C4', 'D4', 'a3', 'A3', 'G3', 'A3', 'a3', 'A3', 'a3', 'C4', 'D4', 'G3', '', 'G3', 'G3', 'E3', 'E3', 'A3', 'A3', 'F3', 'F3', 'C4', 'a3', 'A3', 'G3', 'A3', 'A3', 'a3', 'G3', 'A3', 'F3', 'a3', 'A3', 'a3', 'G3', 'A3', 'F3', 'G3', 'd3', 'A3', 'G3', 'A3'] ,
]

sample_dura = [
    [16, 16, 16, 16, 8, 8, 8, 8, 8, 8, 8, 8, 4, 8, 16, 16, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 4, 4, 16, 16, 16, 16, 16, 16, 16, 16 ],
    [8, 8, 8, 8, 8, 16, 16, 16, 16, 8, 8, 16, 16, 8, 8, 4, 4, 1, 1] ,
    [4, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 4, 4, 4, 4, 8, 16, 16, 4, 8, 8, 8, 8, 8, 8] ,
    [8, 16, 16, 8, 8, 8, 16, 16, 8, 8, 8, 16, 16, 8, 8, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16] ,
    [1, 4, 4, 4, 4, 4, 16, 16, 16, 16, 2, 2, 2] ,
    [4, 8, 8, 4, 8, 8, 4, 4, 4, 4, 4, 4, 8, 8, 4, 8, 8, 8, 8, 8, 8, 4] ,
    [2, 4, 4, 4, 4, 8, 8, 4, 4, 4, 4, 4, 2, 4, 8, 8] ,
    [8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 4, 1, 2, 8, 8, 8, 8] ,
    [2, 4, 4, 2, 4, 4, 4, 8, 8, 4, 8, 8, 4, 4, 4, 4] ,
    [16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16] ,
]

if __name__ == '__main__':
    note, dura = gen_rhythm(10)
    for i in range(10): 
        play.gen(note[i], dura[i], './data/random_case%d.wav' % (i))
    for i in range(len(sample_note)):
        print ("GEN %d" % (i))
        play.gen(sample_note[i], sample_dura[i], './data/sample_case%d.wav' % (i))
